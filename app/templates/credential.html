{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <h1>Available Credentials</h1>
        <div id="content" class="content-wrap1 content-center col-md-11 col-sm-11">
            <div class="genericErrors" id="genericErrorsDesc"></div>
            <div id="response">Loading...</div>
        </div>
    </div>
</div>
<script>
    window.onload = function() {
        fetch('{{redirect_url}}/credentials_list')
        .then(response => response.json()) // Parse the response as JSON
        .then(data => {
            const credentials = data.credentialIDs;
            const container = document.getElementById('response');
            container.textContent="";
            credentials.forEach(credential => {
                const credentialItem = document.createElement('div');
                credentialItem.addEventListener('click', function() {
                    fetch('{{redirect_url}}/set_credentialId', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ credentialID: credential }),
                    })
                    .then(response => console.log(response)) // Get the response as a string                
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    window.location.href = "{{redirect_url}}/select_document";
                });
                credentialItem.textContent = credential;
                credentialItem.style.cursor = 'pointer';
                credentialItem.style.padding = '5px';
                credentialItem.style.margin = '5px 0';
                credentialItem.style.border = '1px solid #ccc';
                credentialItem.style.borderRadius = '4px';
                credentialItem.style.backgroundColor = '#f9f9f9';
                container.appendChild(credentialItem);
            });
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    };
</script>
{% endblock %}